{% from 'events/management/_create_event_button.html' import create_event_link %}

<main id="category-container">
    <div id="category-header">
        <h1 class="category-title">
            {% block title %}
                {% if category.title == 'Home' and category.is_root %}
                    {% if category.children %}
                        {% trans %}Main categories{% endtrans %}
                    {% else %}
                        {% trans %}All events{% endtrans %}
                    {% endif %}
                {% else %}
                    {{ category.title }}
                {% endif %}
            {% endblock %}
        </h1>
        {% block cat_toolbar %}
            <div id="search-box" class="search-box"
                 data-category="{{ {'id': category.id, 'isRoot': category.is_root, 'title': category.title} | tojson | forceescape }}"
                 {% if session.user and session.user.is_admin %}data-is-admin{% endif %}
            ></div>
            <div id="category-toolbar">
                <div class="group">
                    {% block cat_create_event %}
                        <ind-menu>
                            <button id="create-event-button" aria-controls="create-event-menu" aria-expanded="false">
                                {% trans %}Create event{% endtrans %}
                            </button>
                            <menu id="create-event-menu">
                                <li>{{ create_event_link(category, 'lecture', _('Lecture')) }}</li>
                                <li>{{ create_event_link(category, 'meeting', _('Meeting')) }}</li>
                                <li>{{ create_event_link(category, 'conference', _('Conference')) }}</li>
                            </menu>
                        </ind-menu>
                    {% endblock %}
                    {% block cat_navigate %}
                        <ind-with-tooltip>
                            <button id="navigate-button" aria-label="{% trans %}Navigate categories{% endtrans %}">
                                {% trans %}Navigate{% endtrans %}
                                <span data-tip-content>{% trans %}Navigate categories{% endtrans %}</span>
                            </button>
                        </ind-with-tooltip>
                    {% endblock %}
                    {% block cat_parent %}
                        {% if not category.is_root %}
                            <a id="parent-category-button" href="{{ category.parent.url }}">
                                {% trans %}Parent category{% endtrans %}
                            </a>
                        {% endif %}
                    {% endblock %}
                    {% block cat_export %}
                        <div id="category-calendar-link" data-category-id="{{ category.id }}"></div>
                    {% endblock %}
                    {% block cat_view_dropdown %}
                        <ind-menu>
                            <ind-with-tooltip>
                                <button id="view-button" aria-controls="view-mode-menu">
                                    <span data-tip-content>{% trans %}View{% endtrans %}</span>
                                </button>
                            </ind-with-tooltip>
                            <menu id="view-mode-menu">
                                {% if category.is_flat_view_enabled and category.children %}
                                    <li>
                                        <a href="{{ url_for('.display', category, flat=1) }}">{% trans %}All category events{% endtrans %}</a>
                                    </li>
                                {% endif %}
                                <li>
                                    <a href="{{ url_for('.upcoming_event', category) }}">{% trans %}Upcoming event{% endtrans %}</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('.overview', category, period='day') }}">{% trans %}Today's events{% endtrans %}</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('.overview', category, period='week') }}">{% trans %}Week's events{% endtrans %}</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('.calendar', category) }}">{% trans %}Calendar{% endtrans %}</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('.statistics', category) }}">{% trans %}Category statistics{% endtrans %}</a>
                                </li>
                            </menu>
                        </ind-menu>
                    {% endblock %}
                    {% block cat_manage %}
                        {% if category.can_manage(session.user) %}
                            <ind-with-tooltip>
                                <a id="category-managment-link" href="{{ url_for('categories.manage_content', category) }}">
                                    <span data-tip-content>{% trans %}Manage category{% endtrans %}</span>
                                </a>
                            </ind-with-tooltip>
                        {% endif %}
                    {% endblock %}
                    {% block cat_user_favorites %}
                        {% if session.user and not category.is_root %}
                            <div class="group">
                                <div id="fav-button" data-category-id="{{ category.id }}"
                                    {{ 'data-favorited' if category in session.user.favorite_categories }}></div>
                            </div>
                        {% endif %}
                    {% endblock %}
                </div>
            </div>
        {% endblock %}
    </div>

    <div id="category-content-wrapper">
        <div class="category-content">
            <div class="category-content-inner">
                {% include 'flashed_messages.html' %}
                {% block content %}{% endblock %}
            </div>
        </div>

        {% if self.sidebar() %}
            <div id="category-sidebar">
                {%- block sidebar %}{% endblock -%}
            </div>
        {% endif %}
    </div>
</main>

<ind-category-navigator triggeredby="navigate-button"
                        category-id="{{ category.id }}">
</ind-category-navigator>

<script type="application/ld+json">
{{ json_ld|tojson }}
</script>
